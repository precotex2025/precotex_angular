<div class="container">
    <!-- ventana nro 4 - historial -->
    <div class="grid-container">

        <div class="title" style="color:white;">REPORTE DE LECTURA DE PERMISOS</div>

        <form class="container-cuerpo" [formGroup]="formulario">
            <div class="container-cuerpo-fila21">



                <mat-form-field class="fila21-dni" appearance="fill">
                    <mat-label>Rango de Fecha</mat-label>
                    <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                        <input matStartDate formControlName="start" placeholder="Fecha Inicio" />
                        <input matEndDate formControlName="end" placeholder="Fecha Final" />
                    </mat-date-range-input>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>

                    <mat-error *ngIf="range.controls.start.hasError('matStartDateInvalid')">Fecha Invalida</mat-error>
                    <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')">Fecha Invalida</mat-error>
                </mat-form-field>
                <mat-form-field class="fila1-Filtro" appearance="fill">
                    <mat-label>Tipo</mat-label>
                    <mat-select formControlName="tipo">
                        <mat-option value="P">PERMISOS</mat-option>
                        <mat-option value="R">REFRIGERIO</mat-option>
                        <mat-option value="C">COMISIONES</mat-option>
                        <mat-option value="D">PERMISO POR DÍA</mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field class="fila1-nombres" appearance="fill">
                    <mat-label>DNI</mat-label>
                    <input matInput type="number" placeholder="Buscar por DNI" (keyup)="buscarUsuario($event)"/>

                </mat-form-field>

                <button type="button" class="fila21-buscar" mat-flat-button (click)="MostrarCabeceraPaquetes()">
                    <mat-icon aria-label="person">search</mat-icon>Buscar
                </button>
                <button type="button" class="fila1-excel" mat-flat-button (click)="generateExcel()">
                    <mat-icon aria-label="create_new_folder">create_new_folder </mat-icon>
                    Reporte Excel
                </button>

            </div>

            <!-- hora	tipo	num_guia	cod_proveedor	des_proveedor	cod_usuario -->
            <div class="container-cuerpo-fila2" *ngIf="Tipo == 'C'">
                <table mat-table #table [dataSource]="dataSource" class="mat-elevation-z8">
                    <ng-container matColumnDef="Num_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">N° Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Num_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Fec_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">F. Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Fec_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Nom_Trabajador">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Nom. Trabajador</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Nom_Trabajador}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Nom_Trabajador_Aprob">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Jefe Inmediato</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Nom_Trabajador_Aprob}} </td>
                    </ng-container>
                    <!-- <ng-container matColumnDef="Cod_Tipo_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Cod. Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Cod_Tipo_Permiso}} </td>
                    </ng-container> -->
                    <ng-container matColumnDef="Des_Tipo_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Tipo Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Des_Tipo_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Inicio">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Hora de Inicio</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Inicio}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Termino">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Hora de Termino</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Termino}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Sede_partida">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Sede Partida</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Sede_partida}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Inicio_Lectura">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Hora Lectura</th>
                        <td mat-cell *matCellDef="let data_det" > {{data_det.Inicio_Lectura}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Tipo_Lectura">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                            Tipo Lectura
                        </th>
                        <td mat-cell *matCellDef="let data_det"> 
                            {{data_det.Tipo_Lectura}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="Sede">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Sede Lectura</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Sede}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Observacion">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Observacion</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Observacion}} </td>
                    </ng-container>


                    <tr mat-header-row *matHeaderRowDef="displayedColumns_cab"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns_cab;"></tr>
                </table>


            </div>


            <div class="container-cuerpo-fila2" *ngIf="Tipo == 'P'">
                <table mat-table #table [dataSource]="dataSource" class="mat-elevation-z8">
                    <ng-container matColumnDef="Num_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">N° Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Num_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Fec_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">F. Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Fec_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Nom_Trabajador">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Nom. Trabajador</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Nom_Trabajador}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Dni">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">DNI</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Dni}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Nom_Trabajador_Aprob">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Jefe Inmediato</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Nom_Trabajador_Aprob}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Motivo_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Mot. Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Motivo_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Des_Tipo_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Tipo Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Des_Tipo_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Inicio">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Hora de Inicio</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Inicio}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Termino">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Hora de Termino</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Termino}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Sede_partida">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Sede Partida</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Sede_partida}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Inicio_Lectura">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Inicio Lectura</th>
                        <td mat-cell *matCellDef="let data_det" class="td_termino" [ngStyle]="{'background': data_det.Inicio_Lectura == null || data_det.Inicio_Lectura == '' ? '#EF5350' : 'rgb(45, 158, 45)' }"> {{data_det.Inicio_Lectura}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Termino_Lectura">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Termino Lectura</th>
                        <td mat-cell *matCellDef="let data_det" class="td_termino" [ngStyle]="{'background': (data_det.Termino_Lectura == null || data_det.Termino_Lectura == '') && data_det.Des_Tipo_Permiso == 'PERMISO CON RETORNO' ? '#EF5350' :  (data_det.Des_Tipo_Permiso == 'PERMISO DE INGRESO') && data_det.Inicio_Lectura != '' ? 'rgb(45, 158, 45)' : data_det.Des_Tipo_Permiso == 'PERMISO CON RETORNO' && data_det.Termino_Lectura != '' ? 'rgb(45, 158, 45)'  :  data_det.Des_Tipo_Permiso == 'PERMISO SIN RETORNO' && data_det.Inicio_Lectura != '' ? 'rgb(45, 158, 45)' : '#EF5350' }"> {{data_det.Termino_Lectura}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Marcacion_Entrada">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Marcación Entrada</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Marcacion_Entrada}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Marcacion_Salida">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Marcación Salida</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Marcacion_Salida}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Observacion">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Observacion</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Observacion}} </td>
                    </ng-container>


                    <tr mat-header-row *matHeaderRowDef="displayedColumns_cab2"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns_cab2;"></tr>
                </table>
     

            </div>


            <div class="container-cuerpo-fila2" *ngIf="Tipo == 'R' || Tipo == 'D'">
                <table mat-table #table [dataSource]="dataSource" class="mat-elevation-z8">
                    <ng-container matColumnDef="Num_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">N° Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Num_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Fec_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">F. Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Fec_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Nom_Trabajador">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Nom. Trabajador</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Nom_Trabajador}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Nom_Trabajador_Aprob">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Jefe Inmediato</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Nom_Trabajador_Aprob}} </td>
                    </ng-container>
                    <!-- <ng-container matColumnDef="Cod_Tipo_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Cod. Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Cod_Tipo_Permiso}} </td>
                    </ng-container> -->
                    <ng-container matColumnDef="Des_Tipo_Permiso">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Tipo Permiso</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Des_Tipo_Permiso}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Inicio">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Hora de Inicio</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Inicio}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Termino">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Hora de Termino</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Termino}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Sede_partida">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Sede Partida</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Sede_partida}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Inicio_Lectura">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Inicio Lectura</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Inicio_Lectura}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Termino_Lectura">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Termino Lectura</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Termino_Lectura}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Marcacion_Entrada">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Marcación Entrada</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Marcacion_Entrada}} </td>
                    </ng-container>
                    <ng-container matColumnDef="Marcacion_Salida">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Marcación Salida</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Marcacion_Salida}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Observacion">
                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Observacion</th>
                        <td mat-cell *matCellDef="let data_det"> {{data_det.Observacion}} </td>
                    </ng-container>


                    <tr mat-header-row *matHeaderRowDef="displayedColumns_cab3"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns_cab3;"></tr>
                </table>
     

            </div>
        </form>

    </div>

</div>

<ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="default" type="ball-spin">
    <p style="color: white; text-align: center; ">Cargando... </p>
</ngx-spinner>