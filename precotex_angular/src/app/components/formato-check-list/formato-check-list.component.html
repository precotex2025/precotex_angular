<!--DefectosAlamacenDerivados-->

<div class="container">
    <!-- ventana nro 4 - historial -->
    <div class="grid-container">
      <div class="title">FORMATO CHECK LIST INGRESO A INSPECCIÓN</div>
  
      <form class="container-cuerpo" [formGroup]="formulario">
        <div class="container-cuerpo-fila1">
          <mat-form-field class="fila1-fecha" appearance="fill">
            <mat-label>Rango de Fecha</mat-label>
            <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
              <input
                matStartDate
                formControlName="start"
                placeholder="Fecha Inicio"
              />
              <input matEndDate formControlName="end" placeholder="Fecha Final" />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
            <mat-icon class="maticon-date" (click)="clearDate($event)"
              >clear</mat-icon
            >
            <mat-error
              *ngIf="range.controls.start.hasError('matStartDateInvalid')"
              >Fecha Invalida</mat-error
            >
            <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')"
              >Fecha Invalida</mat-error
            >
          </mat-form-field>
  
          <mat-form-field class="fila1-OP">
            <mat-label>OP</mat-label>
            <input
              matInput
              type="text"
              maxlength="5"
              placeholder="OP"
              value=""
              autocomplete="off"
              formControlName="Cod_OrdPro"
            />
          </mat-form-field>
  
          <mat-form-field class="fila1-Filtro" appearance="fill">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="estado">
              <mat-option value="R">RECHAZADO</mat-option>
              <mat-option value="A">APROBADO</mat-option>
              <mat-option value="P">REPROCESO</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="fila1-Rechazo" appearance="fill">
            <mat-label>Hoja Rechazo</mat-label>
            <mat-select formControlName="Hoja_Rechazo">
              <mat-option value="SI">SI</mat-option>
              <mat-option value="NO">NO</mat-option>
            </mat-select>
          </mat-form-field>
          <!-- <ng-select 
          class="fila1-Filtro"
          [items]="estados" 
          bindLabel="estado" 
          bindValue="id"
          placeholder="Estado"
          formControlName="estado">
          </ng-select> -->
  
          <mat-form-field class="fila1-Input">
            <mat-label>Estilo Cliente</mat-label>
            <input
              matInput
              type="text"
              
              placeholder="Estilo"
              value=""
              autocomplete="off"
              formControlName="partida"
            />
          </mat-form-field>
  
          <button
            type="button"
            class="fila1-buscar"
            mat-flat-button
            (click)="listarCabecera()"
          >
            <mat-icon aria-label="person">search</mat-icon>Buscar
          </button>
  
          <button
            type="button"
            class="fila1-excel"
            mat-flat-button
            (click)="generateExcel()"
          >
            <mat-icon aria-label="create_new_folder">add</mat-icon>
            AGREGAR NUEVO
          </button>

          <!--<button
            type="button"
            class="fila1-excel2"
            mat-flat-button
            (click)="exportarExcel()"
          >
            <mat-icon aria-label="create_new_folder">file_copy</mat-icon>
            EXPORTAR EXCEL
          </button>-->

          <button mat-flat-button class="fila1-excel2" [matMenuTriggerFor]="menu">
            <mat-icon aria-label="create_new_folder">file_copy</mat-icon> EXPORTAR EXCEL
          </button>

          <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="exportarExcel('L')">Listado Defectos</button>
              <button mat-menu-item (click)="exportarExcel('R')">Resumen Defectos</button>
          </mat-menu>

          <!--<button type="button" [disabled]="this.Flg_Btn_Registrar == false" class="fila1-revertir" mat-flat-button [routerLink]="['/AuditoriaHojaMedidaDetalle']">
                      <mat-icon aria-label="person">cached
                      </mat-icon>  Revertir
                  </button>-->
        </div>
  
        <div class="container-cuerpo-fila2">
          <table
            mat-table
            #table
            [dataSource]="dataSource"
            class="mat-elevation-z8"
          >
  
            <ng-container matColumnDef="Cod_Cliente">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Cliente
              </th>
              <td mat-cell *matCellDef="let data_det">
                {{ data_det.Cod_Cliente }}
              </td>
            </ng-container>
            <ng-container matColumnDef="Cod_EstCli">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Estilo
              </th>
              <td mat-cell *matCellDef="let data_det">{{ data_det.Cod_EstCli }}</td>
            </ng-container>
            <ng-container matColumnDef="Cod_OrdPro">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                OP
              </th>
              <td mat-cell *matCellDef="let data_det">
                {{ data_det.Cod_OrdPro }}
              </td>
            </ng-container>
            <ng-container matColumnDef="Color">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Color
              </th>
              <td mat-cell *matCellDef="let data_det">
                {{ data_det.Color }}
              </td>
            </ng-container>
            <ng-container matColumnDef="Lote">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Lote
              </th>
              <td mat-cell *matCellDef="let data_det">
                {{ data_det.Lote }}
              </td>
            </ng-container>
            <ng-container matColumnDef="Cantidad">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Cantidad
              </th>
              <td mat-cell *matCellDef="let data_det">
                {{ data_det.Cantidad }}
              </td>
            </ng-container>
            <ng-container matColumnDef="Tamano_Muestra">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Tamaño Muestra
              </th>
              <td mat-cell *matCellDef="let data_det">
                {{ data_det.Tamano_Muestra }}
              </td>
            </ng-container>

            <ng-container matColumnDef="Tipo_Prenda">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Tipo Prenda
              </th>
              <td mat-cell *matCellDef="let data_det">{{ data_det.Tipo_Prenda }}</td>
            </ng-container>

            <ng-container matColumnDef="Numero_Defectos">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                N° Defectos
              </th>
              <td mat-cell *matCellDef="let data_det">{{ data_det.Numero_Defectos }}</td>
            </ng-container>
            

            <ng-container matColumnDef="Flg_Aprobado">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Estado
              </th>
              <td mat-cell *matCellDef="let data_det">
                <ng-container *ngIf="data_det.Flg_Estado == null">
                  <ng-container *ngIf="data_det.Flg_Aprobado == 'A'">
                    <span style="padding:8px;background-color:green; color:white;">APROBADO</span>
                  </ng-container>
  
                  <ng-container *ngIf="data_det.Flg_Aprobado == 'R'">
                    <span style="padding:8px;background-color:red; color:white;">RECHAZADO</span>
                  </ng-container>

                  <ng-container *ngIf="data_det.Flg_Aprobado == 'P'">
                    <span style="padding:8px;background-color: darkorange; color:white;">REPROCESO</span>
                  </ng-container>
                </ng-container>

                <ng-container *ngIf="data_det.Flg_Estado != null">
                  <ng-container *ngIf="data_det.Flg_Estado == 'R'">
                    <span style="padding:8px;background-color:red; color:white;">REAUDITADO</span>
                  </ng-container>
  
                  <ng-container *ngIf="data_det.Flg_Estado == 'F'">
                    <span style="padding:8px;background-color:rgb(49, 49, 167); color:white;">FINALIZADO</span>
                  </ng-container>
                </ng-container>
                
              </td>
            </ng-container>
            
            <ng-container matColumnDef="Fecha_Registro">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Fec. Registro
              </th>
              <td mat-cell *matCellDef="let data_det">
                {{ data_det.Fecha_Registro }}
              </td>
            </ng-container>
            <ng-container matColumnDef="Cod_Usuario">
              <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                Cod. Usuario
              </th>
              <td mat-cell *matCellDef="let data_det">
                {{ data_det.Cod_Usuario }}
              </td>
            </ng-container>
  
            <ng-container matColumnDef="ACCIONES">
              <th mat-header-cell *matHeaderCellDef>Acciones</th>
              <td mat-cell *matCellDef="let data_det">
                <a
                  mat-icon-button
                  style="margin-right: 5px"
                  (click)="
                  editarCheckList(
                      data_det
                    )
                  "
                >
                  <mat-icon color="primary">edit</mat-icon>
                </a>

                <a
                  mat-icon-button
                  *ngIf="data_det.Hoja_Rechazo != 'NO RECHAZO'"
                  color="warn"
                  matTooltip="Ficha de Rechazo"
                  style="margin-right: 5px"
                  (click)="
                  abrirRechazo(
                      data_det
                    )
                  "
                >
                  <mat-icon color="primary">assignment</mat-icon>
                </a>

                <a
                  mat-icon-button
                  color="warn"
                  matTooltip="Reproceso"
                  style="margin-right: 5px"
                  (click)="openReproceso(data_det)"
                >
                  <mat-icon color="primary">cached</mat-icon>
                </a>

                <a
                  mat-icon-button
                  color="warn"
                  matTooltip="Reauditoria"
                  style="margin-right: 5px"
                  (click)="onReauditoria(data_det)"
                  *ngIf="data_det.Flg_Aprobado == 'R'"
                >
                  <mat-icon color="accent">update</mat-icon>
                </a>

                <a
                  mat-icon-button
                  color="warn"
                  style="margin-right: 5px"
                  (click)="
                  eliminarCheckList(
                      data_det
                    )
                  "
                >
                  <mat-icon color="primary">delete</mat-icon>
                </a>

                <a
                  mat-icon-button
                  color="warn"
                  matTooltip="Vista Previa"
                  style="margin-right: 5px"
                  (click)="
                  vistaPreviaCheckList(
                      data_det
                    )
                  "
                >
                <mat-icon color="info">receipt</mat-icon>
                </a>

                
              </td>
            </ng-container>
  
            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumns_cab; sticky: true"
            ></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns_cab"></tr>
          </table>
        </div>
      </form>
    </div>
  </div>
  
  <ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="default" type="ball-spin">
    <p style="color: white; text-align: center">Cargando...</p>
  </ngx-spinner>
  