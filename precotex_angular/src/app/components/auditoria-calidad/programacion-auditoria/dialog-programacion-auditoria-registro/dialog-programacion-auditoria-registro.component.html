<div class="container"> 
    <div class="grid-container">  
       <div class="title"><strong *ngIf="Titulo == ''; else titulomodificar" >Registrar </strong>Programación de Auditorias</div>
       <ng-template #titulomodificar><strong>Modificar </strong></ng-template>
        <form class="container-cuerpo" [formGroup]="formulario" #formDirective="ngForm" (ngSubmit)="onSubmit()" >
            <div class="container-cuerpo-cajax">
                <div>
                    <p>
                        <mat-form-field class="example-short-width">
                            <mat-label>Fecha Registro</mat-label>
                            <input matInput [matDatepicker]="Fecha_Programacion" autocomplete="off" formControlName="Fecha_Programacion" >
                            <mat-datepicker-toggle matSuffix [for]="Fecha_Programacion"></mat-datepicker-toggle>
                            <mat-datepicker #Fecha_Programacion></mat-datepicker>
                        </mat-form-field>

                        <!--<mat-form-field class="example-long-width">
                            <mat-label>Tipo</mat-label>
                            <mat-select formControlName="Id_TipoAuditoria">
                                <mat-option *ngFor="let item of dataTipoAuditoria" [value]="item.Id_TipoAuditoria">
                                    {{ item.Des_Auditoria }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>-->

                        <mat-form-field class="example-long-width" appearance="fill">
                            <mat-label>Cliente</mat-label>
                            <input matInput type="text"  #trigger="matAutocompleteTrigger" placeholder="Cliente" formControlName="Nom_Cliente" [matAutocomplete]="autoDataCliente" />
                            <mat-autocomplete autoActiveFirstOption #autoDataCliente="matAutocomplete">
                                <mat-option *ngFor="let item of filtroCliente | async" [value]="item.Nom_Cliente" (click)="selectCliente(item.Cod_Cliente)">
                                    {{ item.Nom_Cliente }}
                                </mat-option> 
                            </mat-autocomplete>
                        </mat-form-field>

                        <!--<mat-form-field class="example-short-width"> 
                            <mat-label>Abr.Cliente</mat-label>
                            <input matInput type="text"  placeholder="Abr.Cliente" value="" (input)="onBuscarEstilo()" 
                                autocomplete="off" formControlName="Abr_Cliente" >
                        </mat-form-field>
    
                        <mat-form-field class="example-long-width"> 
                            <mat-label>Cliente</mat-label>
                            <input matInput type="text"  placeholder="Cliente" value="" 
                                autocomplete="off" formControlName="Nom_Cliente" >
                        </mat-form-field>-->

                        <!--<mat-form-field class="example-short-width" appearance="fill">
                            <mat-label>Estilo</mat-label>
                            <input matInput type="text"  #trigger="matAutocompleteTrigger" placeholder="Estilo" formControlName="Cod_EstCli"  [matAutocomplete]="autoDataEstilo" />
                            <mat-autocomplete autoActiveFirstOption #autoDataEstilo="matAutocomplete">
                                <mat-option *ngFor="let item of filtroEstiloCliente | async" [value]="item.Cod_EstCli" (click)="selectEstilo(item)">
                                    {{ item.Cod_EstCli }}
                                </mat-option> 
                            </mat-autocomplete>
                        </mat-form-field>-->

                        <mat-form-field class="example-short-width">
                            <mat-label>Temporada</mat-label>
                            <mat-select formControlName="Cod_TemCli">
                                <mat-option *ngFor="let item of dataTemporadaCli" (click)="selectTemporada(item)" [value]="item.Cod_TemCli">
                                    {{ item.Nom_TemCli }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>

                        <mat-form-field class="example-short-width"> 
                            <mat-label>OP</mat-label>
                            <input matInput type="text"  placeholder="OP" value="" (input)="onBuscarOp()" autocomplete="off" formControlName="Cod_OrdPro" >
                        </mat-form-field>

                        <mat-form-field class="example-long-width" appearance="fill">
                            <mat-label>PCP</mat-label>
                            <input matInput type="text" #trigger="matAutocompleteTrigger" placeholder="PCP" formControlName="Nom_Auditor" [matAutocomplete]="autoDataAuditor" />
                            <mat-autocomplete autoActiveFirstOption #autoDataAuditor="matAutocomplete">
                                <mat-option *ngFor="let option of filtroOperacionAuditor | async" [value]="option.Nom_Auditor" (click)="seleccionarAuditor(option)">
                                    {{option.Nom_Auditor}}
                                </mat-option> 
                            </mat-autocomplete>
                        </mat-form-field>
                    </p>
                    <!--<p>
                        <mat-form-field class="example-full-width"> 
                            <mat-label>Observaciones</mat-label>
                            <input matInput type="text"   placeholder="Observaciones" value=""
                                autocomplete="off" formControlName="Observacion">
                        </mat-form-field>
                    </p>-->
                </div>

                <div>
                    <div class="table-container">
                        <div class="container-cuerpo-caja">
                            <div class="container-caja1">
                                <mat-form-field>
                                    <mat-label>Filtrar</mat-label>
                                    <input matInput (keyup)="applyFilter($event)" placeholder="Est.Cli/Op" #input>
                                </mat-form-field>
                            </div>
                            <div class="container-caja2">
                                [P]endiente / [A]probado / [R]echazado [D]esfazado
                            </div>
                        </div>


                        <table mat-table #table [dataSource]="dataSource" class="mat-elevation-z8">
                            <!-- Checkbox Column -->
                            <ng-container matColumnDef="select" sticky>
                                <th mat-header-cell *matHeaderCellDef>
                                <mat-checkbox (change)="$event ? masterToggle() : null"
                                                [checked]="selection.hasValue() && isAllSelected()"
                                                [indeterminate]="selection.hasValue() && !isAllSelected()"
                                                [aria-label]="checkboxLabel()">
                                </mat-checkbox>
                                </th>
                                <td mat-cell *matCellDef="let row">
                                <mat-checkbox (click)="$event.stopPropagation()"
                                                (change)="$event ? selection.toggle(row) : null"
                                                [checked]="selection.isSelected(row)"
                                                [aria-label]="checkboxLabel(row)">
                                </mat-checkbox>
                                </td>
                            </ng-container>

                            <!-- Position Column -->

                            <!--<ng-container matColumnDef="Check">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                                    Sel
                                </th>
                                <td mat-cell *matCellDef="let data_op">
                                    <input type="checkbox" name="check" id="check" (change)="changeCheck($event, data_op)" [checked]="data_op.Flg_Status == '1'" class="checkbox">
                                </td>
                            </ng-container>-->

                            <ng-container matColumnDef="Cod_EstCli" sticky>
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Estilo Cliente </th>
                                <td mat-cell *matCellDef="let data_op"> {{ data_op.Cod_EstCli }} </td>
                            </ng-container>

                            <ng-container matColumnDef="Num_PreReq">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Cant.Sol. </th>
                                <td mat-cell *matCellDef="let data_op"> {{ data_op.Num_PreReq }} </td>
                            </ng-container>
                            
                            <ng-container matColumnDef="OPs">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> OPs </th>
                                <td mat-cell *matCellDef="let data_op"> {{ data_op.OPs }} </td>
                            </ng-container>
                            
                            <ng-container matColumnDef="Num_Auditoria">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> N° Auditoria </th>
                                <td mat-cell *matCellDef="let data_op"> {{ data_op.Num_Auditoria }} </td>
                            </ng-container>
                            
                            <ng-container matColumnDef="Fecha_Programacion">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Fecha Programación </th>
                                <!--<td mat-cell *matCellDef="let data_op"> {{ data_op.Fec_Programacion | date: 'dd-MM-yyyy' }} </td>-->
                                <td mat-cell *matCellDef="let data_op">
                                    <span [ngClass]="{'flg_prog_on':data_op.Flg_ProgFec=='1', 'flg_prog_off':data_op.Flg_ProgFec=='0'}">
                                        {{ data_op.Fec_Programacion | date: 'dd-MM-yyyy' }}
                                    </span>
                                </td>
                            </ng-container>

                            <!--<ng-container matColumnDef="Flg_Estado">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Auditoria </th>
                                <td mat-cell *matCellDef="let data_op">
                                    <span> {{ data_op.Flg_Estado == null ? 'Ninguno' : data_op.Des_Estado }} </span>
                                </td>
                            </ng-container>-->

                            <ng-container matColumnDef="Flg_Estado">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Auditoria</th>
                                <td mat-cell *matCellDef="let data_op">
                                    <span [ngClass]="{'flg_green':data_op.Flg_Estado=='0', 'flg_blue':data_op.Flg_Estado=='1', 'flg_red':data_op.Flg_Estado=='2', 'flg_yellow':data_op.Flg_Estado=='3'}">{{ data_op.Des_Estado }}</span>
                                    <!--<span [ngClass]="{'flg_grey':data_op.Flg_Estado==null, 'flg_green':data_op.Flg_Estado=='0', 'flg_blue':data_op.Flg_Estado=='1', 'flg_red':data_op.Flg_Estado=='2', 'flg_yellow':data_op.Flg_Estado=='3'}">{{ data_op.Flg_Estado == null ? 'Ninguno' : data_op.Des_Estado }}</span>-->
                                </td>
                            </ng-container>

                            <!--<ng-container matColumnDef="Flg_Estado_2">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Empaque </th>
                                <td mat-cell *matCellDef="let data_op">
                                    <span> {{ data_op.Flg_Estado_2 == null ? 'Ninguno' : data_op.Des_Estado_2 }} </span>
                                </td>
                            </ng-container>-->

                            <ng-container matColumnDef="Flg_Estado_2">
                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell">Auditoria Empaque</th>
                                <td mat-cell *matCellDef="let data_op">
                                    <span [ngClass]="{'flg_green':data_op.Flg_Estado_2=='0', 'flg_blue':data_op.Flg_Estado_2=='1', 'flg_red':data_op.Flg_Estado_2=='2', 'flg_yellow':data_op.Flg_Estado_2=='3'}">{{ data_op.Des_Estado_2 }}</span>
                                </td>
                            </ng-container>

                            <ng-container [matColumnDef]="column" *ngFor="let column of displayedColumnsFechas">
                                <th style="width: 100px;" mat-header-cell *matHeaderCellDef> {{ column }} </th>
                                <!--<td mat-cell *matCellDef="let element"> {{ element[column] | date: 'dd-MM-yyyy' }} </td>-->
                                <td mat-cell *matCellDef="let element"> {{ element[column] }} </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)"></tr>
                        </table>
    
                    </div>
                </div>
            </div>     
 
            <div class="container-cuerpo-foot">
               <!-- *ngIf="Titulo == undefined; else btnmodificar"  [disabled]="!formulario.valid"-->
                <button  type="submit" class="button-agregar" *ngIf="Titulo == ''; else btnmodificar" mat-dialog-close="false" [disabled]="!formulario.valid" mat-flat-button>
                    <mat-icon aria-label="person">save </mat-icon>Registrar
                </button>

                <ng-template #btnmodificar><button type="submit" class="button-agregar" mat-dialog-close="false" [disabled]="!formulario.valid" mat-flat-button *ngIf="data.IsPcp">
                    <mat-icon aria-label="person">create</mat-icon>Modificar
                </button></ng-template>

                <button type="button" *ngIf="Flg_Edita" class="button-programar" (click)="onProgramarAuditoria('1')" mat-flat-button>
                    <mat-icon aria-label="person">update</mat-icon>Programar
                </button>

                <button type="button" *ngIf="!Flg_Edita && data.IsPcp" class="button-programar" (click)="onProgramarAuditoria('2')" mat-flat-button>
                    <mat-icon aria-label="person">update</mat-icon>Reprogramar
                </button>
              
                <button type="button" class="button-cancelar" mat-button mat-dialog-close mat-dialog-close  mat-flat-button>
                    <mat-icon aria-label="person">highlight_off</mat-icon>Cancelar
                </button>               
            </div>
        </form>
    </div>
</div>