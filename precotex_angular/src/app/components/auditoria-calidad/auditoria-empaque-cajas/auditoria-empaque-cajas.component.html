<div class="container"> 
    <div class="grid-container"> 
        <div class="title">Auditoria de Empaje - Cajas [ {{ln_TotalCajas }} / {{ ln_CajasDefecto }} ]</div>

        <form class="container-cuerpo" [formGroup]="formulario">
            <div class="container-cuerpo-fila1">
                
                <mat-form-field  class="fila1-fecha" appearance="fill">
                    <mat-label>Rango de Fecha</mat-label>
                    <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                      <input matStartDate formControlName="start" placeholder="Fecha Inicio" >
                      <input matEndDate formControlName="end" placeholder="Fecha Final" >
                    </mat-date-range-input>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                    <mat-icon  (click)="clearDate($event)" style=" position: absolute;
                        float: right;
                        top: -6px;
                        margin-left: 180px;
                        cursor: pointer;
                        color: rgba(0, 0, 0, 0.54);">close
                    </mat-icon>
                    <mat-error *ngIf="range.controls.start.hasError('matStartDateInvalid')">Fecha Invalida</mat-error>
                    <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')">Fecha Invalida</mat-error>
                </mat-form-field>

                <mat-form-field class="example-margin">
                    <mat-label>Semana</mat-label>
                    <input matInput type="number" name="numSemana" placeholder="Semana" value="" autocomplete="off" formControlName="numSemana" #numSemana (blur)="onNumeroSemana()">
                </mat-form-field>    

                <mat-form-field class="example-margin">
                    <mat-label>Packing List</mat-label>
                    <input matInput type="number" name="NumPacking" placeholder="Packing List" value="" autocomplete="off" formControlName="NumPacking" >
                </mat-form-field>
                
                <mat-form-field class="lista-auditor" appearance="fill" *ngIf="ll_Supervisor">
                    <mat-label>Auditor</mat-label>
                    <input matInput type="text" #trigger="matAutocompleteTrigger" placeholder="Auditor" formControlName="NomAuditor" [matAutocomplete]="autoDataAuditor" />
                    <mat-autocomplete autoActiveFirstOption #autoDataAuditor="matAutocomplete">
                        <mat-option *ngFor="let option of filtroOperacionAuditor | async" [value]="option.Nom_Auditor" (click)="seleccionarAuditor(option)">
                            {{option.Nom_Auditor}}
                        </mat-option> 
                    </mat-autocomplete>
                    <button matSuffix mat-icon-button aria-label="Limpiar" (click)="limpiarAuditor()">
                        <mat-icon>close</mat-icon>
                    </button>
                </mat-form-field>

                <button type="button" class="boton-buscar" mat-flat-button (click)="onListarAuditoriaEmpaqueCajas()">
                    <mat-icon aria-label="person">search</mat-icon>Buscar
                </button>
                
                <button type="button" class="boton-agregar" mat-flat-button (click)="onInsertarAuditoria('')">
                    <mat-icon aria-label="person">add</mat-icon>Agregar
                </button>

                <button type="button" class="boton-resumen" mat-flat-button (click)="onAvanceAuditoria()">
                    <mat-icon aria-label="person">download_done</mat-icon>Resumen
                </button>

                <button type="button" class="boton-pendiente" mat-flat-button (click)="onPendienteAuditoria()">
                    <mat-icon aria-label="person">question_mark</mat-icon>Pendiente
                </button>

                <button mat-flat-button class="boton-excel" [matMenuTriggerFor]="menu" *ngIf="ll_Supervisor">
                    <mat-icon aria-label="create_new_folder">create_new_folder</mat-icon> Reporte Excel
                </button>

                <mat-menu #menu="matMenu">
                    <button mat-menu-item (click)="onGenerarReporteAuditoria('X')">Reporte Empaque APT</button>
                    <!--<button mat-menu-item (click)="onGenerarReporteAuditoria('A')">Reporte Avance Packing</button>-->
                    <button mat-menu-item (click)="onGenerarPackingAuditoria()">Reporte Avance Packing</button>
                    <button mat-menu-item (click)="onGenerarReporteAuditoria('P')">Reporte Incentivos Ingenieria</button>
                </mat-menu>

                <mat-form-field class="example-margin">
                    <mat-label>N° Caja</mat-label>
                    <input matInput type="number" name="NumCaja" placeholder="N° Caja" value="" autocomplete="off" formControlName="NumCaja" #numCaja (input)="onValidarNumeroCaja()">
                </mat-form-field>    
        </div>

            <div class="container-cuerpo-fila2">
                <table mat-table #table [dataSource]="dataSource" matSort matSortActive="Num_Auditoria" matSortDirection="desc" class="mat-elevation-z8" >

                    <ng-container matColumnDef="Num_Auditoria">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell"> Nº Auditoria </th>
                        <td mat-cell  *matCellDef="let data_det"> {{ data_det.Num_Auditoria }} </td>
                    </ng-container>

                    <ng-container matColumnDef="Fec_Ini_Auditoria">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell"> Fecha </th>
                        <td mat-cell *matCellDef="let data_det"> {{ data_det.Fec_Ini_Auditoria | date: 'dd-MM-yyyy hh:mm' }} </td>
                    </ng-container>

                    <ng-container matColumnDef="Num_Packing">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell"> Packing List </th>
                        <td mat-cell  *matCellDef="let data_det"> {{data_det.Num_Packing}} </td>
                    </ng-container>
  
                    <ng-container matColumnDef="Num_Caja">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell"> N° Caja </th>
                        <td mat-cell  *matCellDef="let data_det"> {{data_det.Num_Caja}} </td>
                    </ng-container>
  
                    <ng-container matColumnDef="Des_Cliente">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell"> Cliente </th>
                        <td mat-cell  *matCellDef="let data_det"> {{data_det.Des_Cliente}} </td>
                    </ng-container>
  
                    <ng-container matColumnDef="Des_Modulo">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell"> Modulo </th>
                        <td mat-cell  *matCellDef="let data_det"> {{data_det.Des_Modulo}} </td>
                    </ng-container>
  
                    <ng-container matColumnDef="Num_Vez">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell"> Ocurrencia </th>
                        <td mat-cell  *matCellDef="let data_det"> {{data_det.Num_Vez}} </td>
                    </ng-container>
  
                    <ng-container matColumnDef="Nom_Auditor">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell"> Auditor </th>
                        <td mat-cell  *matCellDef="let data_det"> {{data_det.Nom_Auditor}} </td>
                    </ng-container>
  
                    <ng-container matColumnDef="Flg_Estado">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell">Estado</th>
                        <td mat-cell *matCellDef="let data_det" >    
                            <!--<button *ngIf="data_det.Flg_Estado == '0';" type="button" style="background:#0e740e; color:#ffffff; width: 110px;" (click)="onDuplicarAuditoria(data_det)" mat-flat-button>Pendiente</button>-->
                            <button *ngIf="data_det.Flg_Estado == 'P';" type="button" style="background:#0e740e; color:#ffffff; width: 110px;" mat-flat-button>Pendiente</button>
                            <button *ngIf="data_det.Flg_Estado == 'A';" type="button" style="background:#1837e9; color:#ffffff; width: 110px;" mat-flat-button>Aprobado</button>
                            <button *ngIf="data_det.Flg_Estado == 'R';" type="button" style="background:#f44336; color:#ffffff; width: 110px;" mat-flat-button>Rechazado</button>
                        </td>
                    </ng-container> 
                    
                    <ng-container matColumnDef="Acciones">
                        <th mat-header-cell *matHeaderCellDef> Acciones </th>
                        <td mat-cell *matCellDef="let data_det">    
                            <a mat-icon-button (click)="onEditarAuditoria(data_det)"><mat-icon color="success">create</mat-icon></a> 
                            <a mat-icon-button (click)="onEliminarAuditoria(data_det)" *ngIf="ll_Supervisor"><mat-icon color="warn">delete</mat-icon></a>
                        </td>
                    </ng-container> 
                
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

                </table>

                <mat-paginator  class="paginador" #paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons aria-label="Select page of periodic elements">
                </mat-paginator>

            </div>
        </form>
    </div> 
</div>

<ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="default" type="ball-spin">  
    <p style="color: white; text-align: center; " >Cargando... </p>  
</ngx-spinner> 