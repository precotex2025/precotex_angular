<div class="container-fluid">
    <div class="grid-container">
        <div class="title">Registro Acta Comite de Emergencia {{ data.Num_Acta }}</div>

        <div class="find">
            <div class="list-form" [formGroup]="formulario">
                <mat-card class="example-card">
                    <mat-card-content>
                        <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
                            <mat-tab label="Registro">
                                <br>
                                <p>
                                    <mat-form-field class="example-width-20" appearance="outline">
                                        <mat-label>Fecha Evento</mat-label>
                                        <input matInput type="datetime-local" formControlName="Fec_ActaComite">
                                    </mat-form-field>

                                    <mat-form-field class="example-width-35" appearance="outline">
                                        <mat-label>Sede</mat-label>
                                        <mat-select formControlName="Id_Sede">
                                            <mat-option *ngFor="let item of dataSede" [value]="item.Id_Planta">
                                                {{ item.des_planta }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>

                                    <mat-form-field class="example-width-35" appearance="outline">
                                        <mat-label>Dependencia</mat-label>
                                        <mat-select formControlName="Id_Area">
                                            <mat-option *ngFor="let item of filtrarAreasPlanta()" [value]="item.Id_Area">
                                                {{ item.Des_Area }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>

                                    <mat-form-field class="example-width-35" appearance="outline">
                                        <mat-label>Proceso</mat-label>
                                        <mat-select formControlName="Id_Proceso">
                                            <mat-option *ngFor="let item of dataProceso" [value]="item.Id_Proceso">
                                                {{ item.Des_Proceso }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>

                                    <!--<mat-form-field class="example-width-35" appearance="outline">
                                        <mat-label>Problema</mat-label>
                                        <mat-select formControlName="Id_Problema">
                                            <mat-option *ngFor="let item of dataProblema" [value]="item.Id_Problema">
                                                {{ item.Des_Problema }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>-->

                                    <mat-form-field class="example-width-35" appearance="outline">
                                        <mat-label>Problema</mat-label>
                                        <input matInput type="text" name="Det_Problema" formControlName="Det_Problema" placeholder="Problema">
                                    </mat-form-field>

                                    <mat-form-field appearance="outline">
                                        <mat-label>OP</mat-label>
                                        <input matInput type="text" name="Cod_OrdPro" formControlName="Cod_OrdPro" placeholder="OP" (blur)="onBuscarOP($any($event).target.value)">
                                    </mat-form-field>

                                    <mat-form-field class="example-width-35" appearance="outline">
                                        <mat-label>Partida/Color</mat-label>
                                        <mat-select formControlName="Cod_OrdTra">
                                            <mat-option *ngFor="let item of dataPartida" [value]="item.Cod_OrdTra" (click)="onSelectPartida(item.Cod_OrdTra)">
                                                {{ item.Des_PartColor }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>

                                    <mat-form-field class="example-width-35" appearance="outline">
                                        <mat-label>Cliente</mat-label>
                                        <input matInput type="text" name="Des_Cliente" formControlName="Des_Cliente" placeholder="Cliente">
                                    </mat-form-field>

                                    <mat-form-field appearance="outline">
                                        <mat-label>Estilo Cliente</mat-label>
                                        <input matInput type="text" name="Cod_EstCli" formControlName="Cod_EstCli" placeholder="Estilo Cliente">
                                    </mat-form-field>

                                    <mat-form-field class="example-full-width" appearance="outline">
                                        <mat-label>Detalle de la No Conformidad/Problema:</mat-label>
                                        <textarea rows="2" matInput type="text" placeholder="Detalle" value="" autocomplete="off" formControlName="Des_Detalle"></textarea>
                                    </mat-form-field>

                                    <mat-form-field class="example-full-width" appearance="outline">
                                        <mat-label>Decisión Final:</mat-label>
                                        <textarea rows="2" matInput type="text" placeholder="Decisión Final" value="" autocomplete="off" formControlName="Des_Decision"></textarea>
                                    </mat-form-field>
                                </p>
                            </mat-tab>

                            <mat-tab label="Votación">
                                <br>
                                <p>
                                    <mat-form-field class="example-width-50" appearance="outline">
                                        <mat-label>Participante</mat-label>
                                        <input matInput type="text" #trigger="matAutocompleteTrigger" placeholder="Trabajador" formControlName="Nom_Trabajador" [matAutocomplete]="autoDataTrabajador" />
                                        <mat-autocomplete autoActiveFirstOption #autoDataTrabajador="matAutocomplete">
                                            <mat-option *ngFor="let option of filtroTrabajador | async" [value]="option.Trabajador" (click)="selectTrabajador(option)">
                                                {{option.Trabajador}}
                                            </mat-option> 
                                        </mat-autocomplete>
                                    </mat-form-field>

                                    <mat-form-field class="example-width-20" appearance="outline">
                                        <mat-label>Voto</mat-label>
                                        <mat-select formControlName="Flg_Voto">
                                            <mat-option *ngFor="let item of dataVoto" [value]="item.Flg_Voto">
                                                {{ item.Des_Voto }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>

                                    <button mat-button type="button" color="primary" (click)="onInsertarParticipante()"><mat-icon>add</mat-icon>Agregar</button>
                                </p>

                                <div class="col-md-12 tabla">
                                    <table mat-table [dataSource]='dataSource' matSort #sortData1="matSort" matSortActive="Nom_Trabajador" matSortDirection="asc" class="mat-elevation-z8">
                                        <ng-container matColumnDef="Nom_Trabajador">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Apellidos y Nombres </th>
                                            <td mat-cell *matCellDef="let element"> {{ element.Nom_Trabajador }} </td>
                                        </ng-container>
                
                                        <ng-container matColumnDef="Des_Ocupacion">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Cargo </th>
                                            <td mat-cell *matCellDef="let element"> {{ element.Des_Ocupacion }} </td>
                                        </ng-container>
                
                                        <ng-container matColumnDef="flg_Voto1">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Voto Favor </th>
                                            <td mat-cell *matCellDef="let element"> {{ (element.Flg_Voto == '1' ? 'X' : '') }} </td>
                                        </ng-container>
                
                                        <ng-container matColumnDef="flg_Voto2">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Voto Contra </th>
                                            <td mat-cell *matCellDef="let element"> {{ (element.Flg_Voto == '0' ? 'X' : '') }} </td>
                                        </ng-container>
                
                                        <ng-container matColumnDef="Des_Area">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Area </th>
                                            <td mat-cell *matCellDef="let element"> {{ element.Des_Area }} </td>
                                        </ng-container>
                
                                        <!--<ng-container matColumnDef="Firma">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Firma </th>
                                            <td mat-cell *matCellDef="let element"> {{ element.flg_Voto }} </td>
                                        </ng-container>-->
                
                                        <ng-container matColumnDef="Acciones">
                                            <th mat-header-cell *matHeaderCellDef>Acciones</th>
                                            <td class="mat-header-cell" mat-cell *matCellDef="let element">
                                                <a mat-icon-button (click)="onQuitarParticipante(element)" matTooltip="Anular entrega">
                                                    <mat-icon color="warn">delete</mat-icon>
                                                </a>
                                            </td>
                                        </ng-container>
                
                                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                    </table>
                
                                    <mat-paginator #paginatorData1 [pageSizeOptions]="[3, 5, 10]" showFirstLastButtons></mat-paginator>
                                </div>
                                <mat-divider></mat-divider>
                                <br>
                                <p>                                    
                                    <mat-form-field class="example-width-20" appearance="outline">
                                        <mat-label>Votos a Favor</mat-label>
                                        <input matInput type="text" name="Voto_Favor" formControlName="Voto_Favor" placeholder="Votos a Favor">
                                    </mat-form-field>

                                    <mat-form-field class="example-width-20" appearance="outline">
                                        <mat-label>Votos en Contra</mat-label>
                                        <input matInput type="text" name="Voto_Contra" formControlName="Voto_Contra" placeholder="Votos en Contra">
                                    </mat-form-field>

                                    <mat-form-field class="example-width-35" appearance="outline">
                                        <mat-label>Resultado</mat-label>
                                        <input matInput type="text" name="Resultado" formControlName="Resultado" placeholder="Resultado">
                                    </mat-form-field>

                                    <mat-form-field class="example-width-50" appearance="outline">
                                        <mat-label>Responsable del Acta</mat-label>
                                        <input matInput type="text" name="Nom_Responsable" formControlName="Nom_Responsable" placeholder="Responsable">
                                    </mat-form-field>
                                </p>
                            </mat-tab>
                        </mat-tab-group>
                        <mat-divider></mat-divider>
                    </mat-card-content>

                    <mat-card-actions>
                        <button mat-button type="submit" color="primary" [mat-dialog-close]="formulario.value" [disabled]="formulario.invalid" *ngIf="ll_Pendiente"><mat-icon>done</mat-icon>Confirmar</button>
                        <button mat-button mat-dialog-close color="warn"><mat-icon>close</mat-icon>Cancelar</button>
                    </mat-card-actions>
                </mat-card>
            </div>
        </div>
    </div>
</div>