<div class="container-dialog">
    <!-- ventana nro 4 - historial -->
    <div class="grid-container-dialog">

      <div class="title-dialog"><span class="numhoja">{{Titulo}}</span></div>
      <form class="container-cuerpo-dialog" [formGroup]="formulario">

        <div class="container-cuerpo-fila1">
            <mat-tab-group>
                <mat-tab label="Check List Corte">

                    <mat-accordion multi>
                        <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)">
                            <mat-expansion-panel-header>
                                <mat-panel-title>Datos</mat-panel-title>
                            </mat-expansion-panel-header>
                            <div class="container-cuerpo-fila1-content">
        
                                <mat-form-field class="fila1-oc">
                                    <mat-label>O/CORTE</mat-label>
                                    <input matInput type="text" maxlength="5" placeholder="O/CORTE" value="" autocomplete="off" formControlName="sOCorte" (input)="buscarxOCorte()"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-partida">
                                    <mat-label>Partida</mat-label>
                                    <input matInput type="text" placeholder="Partida" value="" autocomplete="off" formControlName="sPartida" />
                                </mat-form-field>     
        
                                <mat-form-field class="fila1-op">
                                    <mat-label>OP</mat-label>
                                    <input matInput type="text" placeholder="OP" value="" autocomplete="off" formControlName="sOp"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-cliente">
                                    <mat-label>Cliente</mat-label>
                                    <input matInput type="text" placeholder="Cliente" value="" autocomplete="off" formControlName="sCliente"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-estilo">
                                    <mat-label>Estilo</mat-label>
                                    <input matInput type="text" placeholder="Estilo" value="" autocomplete="off" formControlName="sEstilo"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-temporada">
                                    <mat-label>Temporada</mat-label>
                                    <input matInput type="text" placeholder="Prenda" value="" autocomplete="off" formControlName="sTemporada"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-color">
                                    <mat-label>Color</mat-label>
                                    <input matInput type="text" placeholder="Color" value="" autocomplete="off" formControlName="sColor"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-tipo-prenda">
                                    <mat-label>Tipo Prenda</mat-label>
                                    <input matInput type="text" placeholder="Tipo Prenda" value="" autocomplete="off" formControlName="sTipoPrenda"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-encogim-ancho">
                                    <mat-label>Ancho</mat-label>
                                    <input matInput type="text" placeholder="Ancho" value="" autocomplete="off" formControlName="sEncogAncho"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-encogim-largo">
                                    <mat-label>Largo</mat-label>
                                    <input matInput type="text" placeholder="Largo" value="" autocomplete="off" formControlName="sEncogLargo"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-tipo-tela">
                                    <mat-label>Código Molde</mat-label>
                                    <input matInput type="text" placeholder="Código Molde" value="" autocomplete="off" formControlName="sCodigoMolde"/>

                                    <!--<mat-label>Tipo de tela</mat-label>
                                    <mat-select formControlName="sTipoTela">
                                        <mat-option *ngFor="let option of lstOptTipoTela" [value]="option.Tipo_Tela" (click)="getMedidas(option)">
                                            {{option.Tipo_Tela | slice:0:250}}
                                        </mat-option>
                                    </mat-select>-->
                                </mat-form-field>

                                <mat-form-field class="fila1-fecha">
                                    <mat-label>Fecha</mat-label>
                                    <input matInput type="datetime-local" formControlName="sFechaHoraIngreso">
                                </mat-form-field>

                                <mat-form-field appearance="fill" class="fila1-turno">
                                    <mat-label>Turno</mat-label>
                                    <mat-select formControlName="sTurno">
                                        <mat-option *ngFor="let item of dataTurno" [value]="item.Turno">
                                            {{item.Des_Turno}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field appearance="fill" class="fila1-auditor">
                                    <mat-label>Auditor</mat-label>
                                    <input matInput type="text" #trigger="matAutocompleteTrigger" placeholder="Auditor" formControlName="sNomAuditor" [matAutocomplete]="autoDataAuditor" />
                                    <mat-autocomplete autoActiveFirstOption #autoDataAuditor="matAutocomplete">
                                        <mat-option *ngFor="let option of filtroOperacionAuditor | async" [value]="option.Nom_Auditor" (click)="onSeleccionarAuditor(option.Cod_Auditor,option.Tip_Trabajador)">
                                            {{option.Nom_Auditor}}
                                        </mat-option> 
                                    </mat-autocomplete>                            
                                </mat-form-field>
                            </div>

                            
                        </mat-expansion-panel>

                        <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                  Tipo de Tela
                                </mat-panel-title>
                            </mat-expansion-panel-header>

                            <div class="table-container">
                                <table mat-table #table [dataSource]="dataSource" class="mat-elevation-z8">
                                    <ng-container matColumnDef="Tipo_Tela">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Tipo de Tela </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Tipo_Tela }} </td>
                                    </ng-container>
                                    
                                    <ng-container matColumnDef="Color_Tela">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Color </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Color_Tela }} </td>
                                    </ng-container>
        
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                </table>
                            </div>
                        </mat-expansion-panel>

                        <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                  Observaciones de Calidad - Ate
                                </mat-panel-title>
                            </mat-expansion-panel-header>

                            <div class="list-container">
                                <mat-list dense>
                                    <mat-list-item *ngFor="let obs of lstObsCalidad">
                                      {{ obs.OBSERVACION }}
                                    </mat-list-item>
                                </mat-list>
                            </div>
                            <br>
                        </mat-expansion-panel>
                    </mat-accordion>
                </mat-tab>

                <mat-tab label="Validación Tizado">

                    <mat-card>
                        <mat-card-header>
                            <div class="row">
                                <div class="col-md-8">VALIDACION TIZADO:</div>
                                <div class="col-md-4">
                                    <mat-slide-toggle (change)="changeAprobacion($event, 'TIZ')" class="example-margin" color="warn" [checked]="Flg_Estado_Tizado == '1'">
                                        <span style="background-color: green; color: white; padding: 2px 4px; font-size: 12px;" *ngIf="Flg_Estado_Tizado == '1'" >A P R O B A D O</span> 
                                        <span style="background-color: red; color: white; padding: 2px 4px; font-size: 12px;" *ngIf="Flg_Estado_Tizado == '0'" >R E C H A Z A D O</span> 
                                    </mat-slide-toggle>
                                </div>
                            </div>
                        </mat-card-header>
                        <mat-card-content>
                            <ul class="list-items-tizado">

                                <li *ngFor="let item of dataItemsTizado; index as i">

                                    <div *ngIf="item.Tipo == 'O'" class="field{{item.IdItem}}">
                                        <mat-list>
                                            <mat-list-item class="list-items-tizado-linea">
                                               <h4 matLine class="list-items-tizado-linea-one">{{item.Item_Nombre_Tizado}}</h4>
                                               <mat-radio-group class="example-radio-group">
                                                    <mat-radio-button class="example-radio-button-interno" *ngFor="let option of optResultado"
                                                        [value]="option.id" 
                                                        [name]="'chk_result_' +  item.IdItem" 
                                                        [checked]="item.Resultado === option.id"
                                                        (change)="changeRadio($event, item.IdItem, 'resultado')">
                                                        {{option.name}}
                                                    </mat-radio-button>
                                                </mat-radio-group>
                                            </mat-list-item>
                                        </mat-list>
                                    </div>
                                    
                                    <div *ngIf="item.Tipo == 'C'" class="field{{item.IdItem}}">
                                        <mat-list>
                                            <mat-list-item>
                                               <h4 matLine>{{item.Item_Nombre_Tizado}}</h4>
                                               <mat-checkbox class="example-margin" color="primary" name="chk_estamp_{{item.IdItem}}" [checked]="item.Resultado == '1'" (change)="changeCheck($event, item.IdItem, 'resultado')"></mat-checkbox>
                                            </mat-list-item>
                                        </mat-list>                                        
                                    </div>

                                </li>
                                
                            </ul>
                            <br>
                            <mat-form-field>
                                <mat-label>Observaciones:</mat-label>
                                <textarea matInput type="text" placeholder="Observaciones" value="" autocomplete="off" formControlName="sObservacionTizado" (change)="changeObservacionTizado($event)"></textarea>
                            </mat-form-field>
                            <br>
                        </mat-card-content>
                    </mat-card>
                </mat-tab>
                <mat-tab label="Validación Tendido">

                    <mat-card>
                        <mat-card-header >
                            <div class="row">
                                <div class="col-md-8">VALIDACION TENDIDO:</div>
                                <div class="col-md-4">
                                    <mat-slide-toggle (change)="changeAprobacion($event, 'TEN')" class="example-margin" color="warn" [checked]="Flg_Estado_Tendido == '1'">
                                        <span style="background-color: green; color: white; padding: 2px 4px; font-size: 12px;" *ngIf="Flg_Estado_Tendido == '1'" >A P R O B A D O</span> 
                                        <span style="background-color: red; color: white; padding: 2px 4px; font-size: 12px;" *ngIf="Flg_Estado_Tendido == '0'" >R E C H A Z A D O</span> 
                                    </mat-slide-toggle>
                                </div>
                            </div>
                        </mat-card-header>
                        <mat-card-content class="container-cuerpo-caja">
                            <div class="container-caja1">

                                <div class="fila2-tendido-content">

                                    <h4 class="fila2-tendido-tela"><B>Periodo reposo tela:</B></h4>
    
                                    <mat-form-field class="fila2-tendido-tela-inicio">
                                        <mat-label>Fecha Hora Inicio:</mat-label>
                                        <input matInput type="datetime-local" formControlName="sPeriodoReposoInicio">
                                    </mat-form-field>
    
                                    <mat-form-field class="fila2-tendido-tela-final">
                                        <mat-label>Fecha Hora Final:</mat-label>
                                        <input matInput type="datetime-local" formControlName="sPeriodoReposoFinal">
                                    </mat-form-field>
    
                                    <mat-form-field class="fila2-tendido-mesa">
                                        <mat-label>Tiempo reposo en mesa</mat-label>
                                        <!--<input matInput type="text" placeholder="00:00" value="" autocomplete="off" formControlName="sTiempoReposo"/>-->
                                        <input [textMask]="{mask: num_guiaMascara}" matInput (change)="validaTiempoReposo($event)" formControlName="sTiempoReposo">
                                        <span matSuffix>Horas</span>
                                    </mat-form-field>
                                    
                                    <mat-form-field appearance="fill" class="fila2-tendido-tipo">
                                        <mat-label>Tipo tendido</mat-label>
                                        <mat-select formControlName="sTipoTendido">
                                            <mat-option *ngFor="let option of optTipoTendido" [value]="option.id">
                                                {{option.name}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
    
                                    <mat-form-field class="fila2-tendido-observacion">
                                        <mat-label>Observaciones:</mat-label>
                                        <textarea matInput type="text" placeholder="Observaciones" value="" autocomplete="off" formControlName="sObservacionTendido" rows="3"></textarea>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="container-caja2">
                                <div class="fila2-tendido-frm">
                                    <div class="fila2-tendido-frm-content">
                                        <h4 class="fila2-tendido-frm-content-titulo"><b>Tendidos</b></h4>

                                        <mat-form-field class="fila2-tendido-frm-content-largo">
                                            <mat-label>Largo</mat-label>
                                            <input matInput type="number" placeholder="Largo" value="" autocomplete="off" formControlName="sLargo"/>
                                            <span matSuffix>metros</span>
                                        </mat-form-field>

                                        <mat-form-field class="fila2-tendido-frm-content-alto">
                                            <mat-label>Alto</mat-label>
                                            <input matInput type="text" placeholder="Alto" value="" autocomplete="off" formControlName="sAlto"/>
                                            <span matSuffix>pulgadas</span>
                                        </mat-form-field>

                                        <mat-form-field class="fila2-tendido-frm-content-cantidad">
                                            <mat-label>Cantidad de paños</mat-label>
                                            <input matInput type="number" placeholder="Cantidad de paños" value="" autocomplete="off" formControlName="sCantidad"/>
                                        </mat-form-field>

                                        <button mat-mini-fab color="primary" (click)="addNumTendido()" *ngIf="Flg_Estado == '0'">
                                            <mat-icon>add</mat-icon>
                                        </button>
                                    </div>
                                    
                                    <div class="table-container-2">
                                        <table mat-table #table [dataSource]="dataTendidoSource" class="mat-elevation-z8">
                                            <ng-container matColumnDef="Id">
                                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> # </th>
                                                <td mat-cell *matCellDef="let data_op"> {{ data_op.nRow }} </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="Largo">
                                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Largo </th>
                                                <td mat-cell *matCellDef="let data_op"> {{ data_op.Largo }} </td>
                                            </ng-container>
                
                                            <ng-container matColumnDef="Alto">
                                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Alto </th>
                                                <td mat-cell *matCellDef="let data_op"> {{ data_op.Alto }} </td>
                                            </ng-container>
                
                                            <ng-container matColumnDef="Cantidad">
                                                <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Cantidad </th>
                                                <td mat-cell *matCellDef="let data_op"> {{ data_op.Cantidad }} </td>
                                            </ng-container>

                                            <ng-container matColumnDef="Acciones">
                                                <th mat-header-cell *matHeaderCellDef> Acciones </th>
                                                <td mat-cell *matCellDef="let element">
                                                    <a mat-icon-button (click)="supItemNumTendido(element)" *ngIf="Flg_Estado == '0'"><mat-icon color="warn">delete</mat-icon></a>
                                                </td>
                                            </ng-container> 
                
                                            <tr mat-header-row *matHeaderRowDef="displayedColumns2;"></tr>
                                            <tr mat-row *matRowDef="let row; columns: displayedColumns2;"></tr>
                                        </table>
                                    </div>
                                    <br>
                                </div>

                            </div>
                        </mat-card-content>
                    </mat-card>
                </mat-tab>
            </mat-tab-group>
        </div>

        <div class="container-cuerpo-foot-dialog">
            <button type="button" class="button-clean-dialog" mat-flat-button [disabled]="isButtonDisabled" (click)="FinalizarHoja()">
                <mat-icon aria-label="person">check_circle</mat-icon>
                Finalizar
            </button>

            <button type="button" class="button-save-dialog" mat-flat-button  *ngIf="btnAccionModificar" (click)="ModificarHoja()" [disabled]="Flg_Estado != '0'">
            <!--<button type="button" class="button-save-dialog" mat-flat-button  *ngIf="btnAccionModificar" (click)="ModificarHoja()">-->
                <mat-icon aria-label="person">save</mat-icon>
                Actualizar
            </button>
    
            <button type="button" class="button-save-dialog" mat-flat-button  *ngIf="!btnAccionModificar" (click)="RegistrarHoja()">
              <mat-icon aria-label="person">save</mat-icon>
              Guardar
            </button>
    
            <button mat-dialog-close type="button" class="button-cancel-dialog" mat-button mat-dialog-close
              mat-dialog-close="false">
              <mat-icon aria-label="person">cancel
              </mat-icon> Cancelar
            </button>
        </div>
          
       </form>

    </div>
</div>
<ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="default" type="ball-spin">
  <p style="color: white; text-align: center; ">Cargando... </p>
</ngx-spinner>