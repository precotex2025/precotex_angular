<div class="container-dialog">
    <!-- ventana nro 4 - historial -->
    <div class="grid-container-dialog">

      <div class="title-dialog"><span class="numhoja">{{Titulo}}</span></div>
      <form class="container-cuerpo-dialog" [formGroup]="formulario">

        <div class="container-cuerpo-fila1">
            <mat-tab-group>
                <mat-tab label="Check List Corte">

                    <mat-accordion multi>
                        <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)">
                            <mat-expansion-panel-header>
                                <mat-panel-title>Datos</mat-panel-title>
                            </mat-expansion-panel-header>
                            <div class="container-cuerpo-fila1-content">
        
                                <mat-form-field class="fila1-oc">
                                    <mat-label>O/CORTE</mat-label>
                                    <input matInput type="text" maxlength="5" placeholder="O/CORTE" value="" autocomplete="off" formControlName="sOCorte" (input)="buscarxOCorte()"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-partida">
                                    <mat-label>Partida</mat-label>
                                    <input matInput type="text" placeholder="Partida" value="" autocomplete="off" formControlName="sPartida" />
                                </mat-form-field>     
        
                                <mat-form-field class="fila1-op">
                                    <mat-label>OP</mat-label>
                                    <input matInput type="text" placeholder="OP" value="" autocomplete="off" formControlName="sOp"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-cliente">
                                    <mat-label>Cliente</mat-label>
                                    <input matInput type="text" placeholder="Cliente" value="" autocomplete="off" formControlName="sCliente"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-estilo">
                                    <mat-label>Estilo</mat-label>
                                    <input matInput type="text" placeholder="Estilo" value="" autocomplete="off" formControlName="sEstilo"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-temporada">
                                    <mat-label>Temporada</mat-label>
                                    <input matInput type="text" placeholder="Prenda" value="" autocomplete="off" formControlName="sTemporada"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-color">
                                    <mat-label>Color</mat-label>
                                    <input matInput type="text" placeholder="Color" value="" autocomplete="off" formControlName="sColor"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-tipo-prenda">
                                    <mat-label>Tipo Prenda</mat-label>
                                    <input matInput type="text" placeholder="Tipo Prenda" value="" autocomplete="off" formControlName="sTipoPrenda"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-encogim-ancho">
                                    <mat-label>Ancho</mat-label>
                                    <input matInput type="text" placeholder="Ancho" value="" autocomplete="off" formControlName="sEncogAncho"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-encogim-largo">
                                    <mat-label>Largo</mat-label>
                                    <input matInput type="text" placeholder="Largo" value="" autocomplete="off" formControlName="sEncogLargo"/>
                                </mat-form-field>
        
                                <mat-form-field class="fila1-tipo-tela">
                                    <mat-label>Código Molde</mat-label>
                                    <input matInput type="text" placeholder="Código Molde" value="" autocomplete="off" formControlName="sCodigoMolde"/>
                                </mat-form-field>

                                <mat-form-field class="fila1-fecha">
                                    <mat-label>Fecha</mat-label>
                                    <input matInput type="datetime-local" formControlName="sFechaAuditoria">
                                </mat-form-field>

                                <mat-form-field appearance="fill" class="fila1-turno">
                                    <mat-label>Turno</mat-label>
                                    <mat-select formControlName="sTurno">
                                        <mat-option *ngFor="let item of dataTurno" [value]="item.Turno">
                                            {{item.Des_Turno}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field appearance="fill" class="fila1-auditor">
                                    <mat-label>Auditor</mat-label>
                                    <input matInput type="text" #trigger="matAutocompleteTrigger" placeholder="Auditor" formControlName="sNomAuditor" [matAutocomplete]="autoDataAuditor" />
                                    <mat-autocomplete autoActiveFirstOption #autoDataAuditor="matAutocomplete">
                                        <mat-option *ngFor="let option of filtroOperacionAuditor | async" [value]="option.Nom_Auditor" (click)="onSeleccionarAuditor(option.Cod_Auditor,option.Tip_Trabajador)">
                                            {{option.Nom_Auditor}}
                                        </mat-option> 
                                    </mat-autocomplete>                            
                                </mat-form-field>
                            </div>                            
                        </mat-expansion-panel>

                        <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                  Tipo de Tela
                                </mat-panel-title>
                            </mat-expansion-panel-header>

                            <div class="table-container">
                                <table mat-table #table [dataSource]="dataSource" class="mat-elevation-z8">
                                    <ng-container matColumnDef="Tipo_Tela">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Tipo de Tela </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Tipo_Tela }} </td>
                                    </ng-container>
                                    
                                    <ng-container matColumnDef="Color_Tela">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Color </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Color_Tela }} </td>
                                    </ng-container>
        
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                </table>
                            </div>
                        </mat-expansion-panel>

                        <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                  Observaciones de Calidad - Ate
                                </mat-panel-title>
                            </mat-expansion-panel-header>

                            <div class="list-container">
                                <mat-list dense>
                                    <mat-list-item *ngFor="let obs of lstObsCalidad">
                                      {{ obs.OBSERVACION }}
                                    </mat-list-item>
                                </mat-list>
                            </div>
                            <br>
                        </mat-expansion-panel>
                    </mat-accordion>
                </mat-tab>

                <mat-tab label="Validación Corte">
                    <mat-card>
                        <mat-card-header >
                            <div class="row">
                                <div class="col-md-8">VALIDACION CORTE:</div>
                            </div>
                        </mat-card-header>
                        <mat-card-content class="container-cuerpo-caja">
                            <div class="container-caja1">
                                <mat-form-field appearance="fill" class="fila1-turno">
                                    <mat-label>Numerado</mat-label>
                                    <mat-select formControlName="sNumSecOrd">
                                        <mat-option *ngFor="let item of lstNumerados" [value]="item.Num_SecOrd" (click)="onSeleccionarNumerado(item.Cod_OrdPro, item.Num_SecOrd)">
                                            {{item.Num_Numerado}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <div class="table-container-2">
                                    <table mat-table #table [dataSource]="dataTallaSource" class="mat-elevation-z8">
                                        <ng-container matColumnDef="Talla">
                                            <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Talla </th>
                                            <td mat-cell *matCellDef="let data_op"> {{ data_op.Talla }} </td>
                                            <td mat-footer-cell *matFooterCellDef> TOTAL </td>
                                        </ng-container>
            
                                        <ng-container matColumnDef="Num_PrePro">
                                            <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Prendas Sol. </th>
                                            <td mat-cell *matCellDef="let data_op"> {{ data_op.Num_PrePro }} </td>
                                            <td mat-footer-cell *matFooterCellDef> {{ getTotalPrePro() }} </td>
                                        </ng-container>
            
                                        <ng-container matColumnDef="Prendas">
                                            <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Prenda Real </th>
                                            <td mat-cell *matCellDef="let data_op"> {{ data_op.Prendas }} </td>
                                            <td mat-footer-cell *matFooterCellDef> {{ getTotalPrendas() }} </td>
                                        </ng-container>

                                        <tr mat-header-row *matHeaderRowDef="displayedColumns2;"></tr>
                                        <tr mat-row *matRowDef="let row; columns: displayedColumns2;"></tr>
                                        <tr mat-footer-row *matFooterRowDef="displayedColumns2"></tr>
                                    </table>
                                </div>
                            </div>

                            <div class="container-caja2">

                                <b>VALIDACION</b>
                                <ul class="list-items-valida">
                                    <li *ngFor="let item of filtrarLstDetalle('1'); index as i">                                           
                                        <div class="field{{item.IdItem}}">
                                            <mat-list>
                                                <mat-list-item>
                                                   <h4 matLine>{{item.Item_Nombre_Tizado}}</h4>
                                                   <mat-checkbox class="example-margin" color="primary" name="chk_estamp_{{item.IdItem}}" [checked]="item.Resultado == '1'" (change)="changeCheck($event, item.IdItem, 'resultado')"></mat-checkbox>
                                                </mat-list-item>
                                            </mat-list>                                        
                                        </div>
                                    </li>                                    
                                </ul>
                                <br>
                                <b>ARTES</b>
                                <ul class="list-items-arte">
                                    <li *ngFor="let item of filtrarLstDetalle('2'); index as i">                                           
                                        <div class="field{{item.IdItem}}">
                                            <mat-list>
                                                <mat-list-item>
                                                   <h4 matLine>{{item.Item_Nombre_Tizado}}</h4>
                                                   <mat-checkbox class="example-margin" color="primary" name="chk_estamp_{{item.IdItem}}" [checked]="item.Resultado == '1'" (change)="changeCheck($event, item.IdItem, 'resultado')"></mat-checkbox>
                                                </mat-list-item>
                                            </mat-list>                                        
                                        </div>
                                    </li>
                                </ul>
                            </div>
    
                        </mat-card-content>
                    </mat-card>
                </mat-tab>

                <mat-tab label="Validación Piezas">
                    <mat-card>
                        <mat-card-header >
                            <div class="row">
                                <div class="col-md-8">VALIDACION PIEZAS:</div>
                            </div>
                        </mat-card-header>

                        <mat-card-content>
                            <div>
                                <div class="table-container-4">
                                    <table mat-table #table [dataSource]="dataPiezaSource" class="mat-elevation-z8">
                                        <ng-container matColumnDef="Flg_Estado">
                                            <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                                                Sel
                                            </th>
                                            <td mat-cell *matCellDef="let data_op">
                                                <input type="checkbox" name="check" id="check" (change)="changeCheckPieza($event, data_op)" [checked]="data_op.Flg_Estado == '1'" class="checkbox">
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="Des_CompEst">
                                            <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Componente </th>
                                            <td mat-cell *matCellDef="let data_op"> {{ data_op.Des_CompEst }} </td>
                                        </ng-container>
                                        
                                        <ng-container matColumnDef="Des_Tela">
                                            <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Nombre Tela </th>
                                            <td mat-cell *matCellDef="let data_op"> {{ data_op.Des_Tela }} </td>
                                        </ng-container>
                                        
                                        <ng-container matColumnDef="Des_PzaEst">
                                            <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Pieza </th>
                                            <td mat-cell *matCellDef="let data_op"> {{ data_op.Des_PzaEst }} </td>
                                        </ng-container>

                                        <tr mat-header-row *matHeaderRowDef="displayedColumns4;"></tr>
                                        <tr mat-row *matRowDef="let row; columns: displayedColumns4;"></tr>
                                    </table>
                                </div>
                                <div>
                                    <mat-form-field class="fila2-observacion">
                                        <mat-label>Observaciones:</mat-label>
                                        <textarea matInput type="text" placeholder="Observaciones" value="" autocomplete="off" formControlName="sObservacion"></textarea>
                                    </mat-form-field>    
                                </div>
                            </div>
                        </mat-card-content>
                    </mat-card>
                </mat-tab>

                <mat-tab label="Defectos">
                    <mat-card>
                        <mat-card-header >
                            <div class="row">
                                <div class="col-md-8">DEFECTOS:</div>

                                <div class="col-md-4">
                                    <mat-slide-toggle class="example-margin" color="warn" [checked]="Flg_Estado_Corte == '1'" [disabled]="true">
                                        <span style="background-color: green; color: white; padding: 2px 4px; font-size: 12px;" *ngIf="Flg_Estado_Corte == '1'" >A P R O B A D O</span> 
                                        <span style="background-color: red; color: white; padding: 2px 4px; font-size: 12px;" *ngIf="Flg_Estado_Corte == '0'" >R E C H A Z A D O</span> 
                                    </mat-slide-toggle>
                                </div>
                            </div>
                        </mat-card-header>

                        <mat-card-content>
                            <div class="container-cuerpo-fila3-content">

                                <mat-form-field class="fila3-lote">
                                    <mat-label>Lote</mat-label>
                                    <input matInput type="number" placeholder="Lote" value="" autocomplete="off" formControlName="sLote" (input)="onCompararLoteConMuestra('M')"/>
                                </mat-form-field>

                                <mat-form-field class="fila3-muestra">
                                    <mat-label>Muestra</mat-label>
                                    <input matInput type="number" placeholder="Muestra" value="" autocomplete="off" formControlName="sMuestra"/>
                                </mat-form-field>

                                <!--<mat-form-field appearance="fill" class="fila3-componente">
                                    <mat-label>Componente</mat-label>
                                    <mat-select formControlName="sCodCompEst">
                                        <mat-option *ngFor="let item of dataComponentes" [value]="item.Cod_CompEst" (click)="onSelectComponente(item.Cod_CompEst, item.Des_CompEst)">
                                            {{item.Des_CompEst}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field appearance="fill" class="fila3-pieza">
                                    <mat-label>Pieza</mat-label>
                                    <mat-select formControlName="sCodPzaEst">
                                        <mat-option *ngFor="let item of dataPiezas" [value]="item.Cod_PzaEst" (click)="onSelectPieza(item.Des_Tela, item.Des_PzaEst)">
                                            {{item.Des_PzaEst}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field class="fila3-tela">
                                    <mat-label>Tela</mat-label>
                                    <input matInput type="text" placeholder="Tela" value="" autocomplete="off" formControlName="sDesTela"/>
                                </mat-form-field>-->

                                <mat-form-field appearance="fill" class="fila3-paquete">
                                    <mat-label>Paquete</mat-label>
                                    <mat-select formControlName="sNumPaquete">
                                        <mat-option *ngFor="let item of lstPaquetes" [value]="item.Num_Paquete" (click)="onSelectPaquete(item)">
                                            {{item.Num_Paquete}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field class="fila3-talla">
                                    <mat-label>Talla</mat-label>
                                    <input matInput type="text" placeholder="Talla" value="" autocomplete="off" formControlName="sCodTalla"/>
                                </mat-form-field>

                                <mat-form-field class="fila3-correlativo">
                                    <mat-label>Correlativo</mat-label>
                                    <input matInput type="text" placeholder="Correlativo" value="" autocomplete="off" formControlName="sNumeracion"/>
                                </mat-form-field>

                                <mat-form-field class="fila3-numero">
                                    <mat-label>Número Piezas</mat-label>
                                    <input matInput type="text" placeholder="Numero Piezas" value="" autocomplete="off" formControlName="sNumPrendas"/>
                                </mat-form-field>

                                <mat-form-field class="fila3-codigo"> 
                                    <mat-label>Codigo</mat-label>
                                    <input matInput type="text" placeholder="Codigo" value="" autocomplete="off" formControlName="sCodMotivo" (change)="onBuscarMotivo()">
                                </mat-form-field>

                                <mat-form-field class="fila3-descripcion"> 
                                    <mat-label>Descripcion</mat-label>
                                    <input matInput type="text" placeholder="Descripcion" value="" autocomplete="off" formControlName="sDesMotivo" >
                                </mat-form-field>

                                <mat-form-field class="fila3-cantidad"> 
                                    <mat-label>Cantidad</mat-label>
                                    <input matInput type="number" placeholder="Cantidad" value="" autocomplete="off" formControlName="sCantidad">
                                </mat-form-field>  

                                <div class="fila3-tipo" >
                                    <mat-radio-group aria-label="Select an option" formControlName="sTipo">
                                        <mat-radio-button class="example-radio-button-interno" value="1">Leve</mat-radio-button>
                                        <mat-radio-button class="example-radio-button-interno" value="2">Crítico</mat-radio-button>
                                    </mat-radio-group>
    
                                    <button mat-mini-fab color="primary" (click)="onRegistrarDefecto()" *ngIf="Flg_Estado == '0'" [disabled] = "isDefectoDisabled">
                                        <mat-icon>add</mat-icon>
                                    </button>    
                                </div>
                            </div>

                            <div class="table-container-3">
                                <table mat-table #table [dataSource]="dataDefectoSource" class="mat-elevation-z8">
                                    <!--<ng-container matColumnDef="Des_CompEst">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Componente </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Des_CompEst }} </td>
                                    </ng-container>
                                    
                                    <ng-container matColumnDef="Des_PzaEst">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Pieza </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Des_PzaEst }} </td>
                                    </ng-container>-->
        
                                    <ng-container matColumnDef="Num_Paquete">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> N° Paquete </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Num_Paquete }} </td>
                                    </ng-container>
        
                                    <ng-container matColumnDef="Des_Motivo">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Defecto </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Des_Motivo }} </td>
                                    </ng-container>
        
                                    <ng-container matColumnDef="Num_Pieza">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Nro. Piezas </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Num_Pieza }} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Cantidad">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Cantidad </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Cantidad }} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Tipo">
                                        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Tipo </th>
                                        <td mat-cell *matCellDef="let data_op"> {{ data_op.Tipo == '1' ? 'LEVE' : 'CRITICO' }} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="Acciones">
                                        <th mat-header-cell *matHeaderCellDef> Acciones </th>
                                        <td mat-cell *matCellDef="let element">
                                            <a mat-icon-button (click)="onEliminarDefecto(element)" *ngIf="Flg_Estado == '0'"><mat-icon color="warn">delete</mat-icon></a>
                                        </td>
                                    </ng-container> 
        
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns3;"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns3;"></tr>
                                </table>
                            </div>
                            <div>
                                <mat-form-field class="fila2-observacion">
                                    <mat-label>Observaciones:</mat-label>
                                    <textarea matInput type="text" placeholder="Observaciones" value="" autocomplete="off" formControlName="sObs_Defectos"></textarea>
                                </mat-form-field>    
                            </div>
                        </mat-card-content>
                    </mat-card>
                </mat-tab>
            </mat-tab-group>
        </div>

        <div class="container-cuerpo-foot-dialog">
            <button type="button" class="button-clean-dialog" mat-flat-button [disabled]="isButtonDisabled" (click)="onFinalizarHoja()">
                <mat-icon aria-label="person">check_circle</mat-icon>
                Finalizar
            </button>

            <button type="button" class="button-save-dialog" mat-flat-button  *ngIf="btnAccionModificar" (click)="onGuardarHoja('U')" [disabled]="Flg_Estado != '0'">
                <mat-icon aria-label="person">save</mat-icon>
                Actualizar
            </button>
    
            <button type="button" class="button-save-dialog" mat-flat-button  *ngIf="!btnAccionModificar" (click)="onGuardarHoja('I')">
              <mat-icon aria-label="person">save</mat-icon>
              Guardar
            </button>
    
            <button mat-dialog-close type="button" class="button-cancel-dialog" mat-button mat-dialog-close
              mat-dialog-close="false">
              <mat-icon aria-label="person">cancel
              </mat-icon> Cancelar
            </button>
        </div>
          
       </form>

    </div>
</div>
<ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="default" type="ball-spin">
  <p style="color: white; text-align: center; ">Cargando... </p>
</ngx-spinner>